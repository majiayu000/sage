[
  {
    "instance_id": "django__django-11039",
    "model_patch": "diff --git a/django/core/management/commands/sqlmigrate.py b/django/core/management/commands/sqlmigrate.py\nindex f0b663222a..1cb2b43c23 100644\n--- a/django/core/management/commands/sqlmigrate.py\n+++ b/django/core/management/commands/sqlmigrate.py\n@@ -56,7 +56,8 @@ class Command(BaseCommand):\n         targets = [(app_label, migration.name)]\n \n         # Show begin/end around output only for atomic migrations\n-        self.output_transaction = migration.atomic\n+        # if the database supports transactional DDL\n+        self.output_transaction = migration.atomic and connection.features.can_rollback_ddl\n \n         # Make a plan that represents just the requested migrations and show SQL\n         # for it\ndiff --git a/tests/migrations/test_commands.py b/tests/migrations/test_commands.py\nindex 0e8fa9fdd1..58fca6111f 100644\n--- a/tests/migrations/test_commands.py\n+++ b/tests/migrations/test_commands.py\n@@ -616,6 +616,23 @@ class MigrateTests(MigrationTestBase):\n             self.assertNotIn(connection.ops.start_transaction_sql().lower(), queries)\n         self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)\n \n+    @override_settings(MIGRATION_MODULES={\"migrations\": \"migrations.test_migrations\"})\n+    def test_sqlmigrate_for_non_transactional_ddl(self):\n+        \"\"\"\n+        Transaction wrappers aren't shown for databases that don't support\n+        transactional DDL, even if the migration is atomic.\n+        \"\"\"\n+        out = io.StringIO()\n+        # Mock can_rollback_ddl to False to simulate a database that doesn't\n+        # support transactional DDL\n+        with mock.patch.object(connection.features, 'can_rollback_ddl', False):\n+            call_command(\"sqlmigrate\", \"migrations\", \"0001\", stdout=out)\n+        output = out.getvalue().lower()\n+        queries = [q.strip() for q in output.splitlines()]\n+        if connection.ops.start_transaction_sql():\n+            self.assertNotIn(connection.ops.start_transaction_sql().lower(), queries)\n+        self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)\n+\n     @override_settings(\n         INSTALLED_APPS=[\n             \"migrations.migrations_test_apps.migrated_app\",",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11049",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex f32ce64629..71005490f3 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -1587,7 +1587,7 @@ class DurationField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n         'invalid': _(\"'%(value)s' value has an invalid format. It must be in \"\n-                     \"[DD] [HH:[MM:]]ss[.uuuuuu] format.\")\n+                     \"[DD] [[HH:]MM:]ss[.uuuuuu] format.\")\n     }\n     description = _(\"Duration\")\n \ndiff --git a/tests/model_fields/test_durationfield.py b/tests/model_fields/test_durationfield.py\nindex b73994f86a..f1c82ab8bd 100644\n--- a/tests/model_fields/test_durationfield.py\n+++ b/tests/model_fields/test_durationfield.py\n@@ -75,7 +75,7 @@ class TestValidation(SimpleTestCase):\n         self.assertEqual(\n             cm.exception.message % cm.exception.params,\n             \"'not a datetime' value has an invalid format. \"\n-            \"It must be in [DD] [HH:[MM:]]ss[.uuuuuu] format.\"\n+            \"It must be in [DD] [[HH:]MM:]ss[.uuuuuu] format.\"\n         )",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11099",
    "model_patch": "diff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py\nindex b4878cfd45..1304f20a60 100644\n--- a/django/contrib/auth/validators.py\n+++ b/django/contrib/auth/validators.py\n@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _\n \n @deconstructible\n class ASCIIUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only English letters, '\n         'numbers, and @/./+/-/_ characters.'\n@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):\n \n @deconstructible\n class UnicodeUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only letters, '\n         'numbers, and @/./+/-/_ characters.'",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11133",
    "model_patch": "diff --git a/django/http/response.py b/django/http/response.py\nindex 6a84e193ba..572f376ba9 100644\n--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -229,7 +229,7 @@ class HttpResponseBase:\n         # Handle string types -- we can't rely on force_bytes here because:\n         # - Python attempts str conversion first\n         # - when self._charset != 'utf-8' it re-encodes the content\n-        if isinstance(value, bytes):\n+        if isinstance(value, (bytes, memoryview)):\n             return bytes(value)\n         if isinstance(value, str):\n             return bytes(value.encode(self.charset))\n@@ -309,7 +309,7 @@ class HttpResponse(HttpResponseBase):\n     @content.setter\n     def content(self, value):\n         # Consume iterators upon assignment to allow repeated iteration.\n-        if hasattr(value, '__iter__') and not isinstance(value, (bytes, str)):\n+        if hasattr(value, '__iter__') and not isinstance(value, (bytes, str, memoryview)):\n             content = b''.join(self.make_bytes(chunk) for chunk in value)\n             if hasattr(value, 'close'):\n                 try:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11179",
    "model_patch": "diff --git a/django/db/models/deletion.py b/django/db/models/deletion.py\nindex 92fe4affb9..3a462f1c4c 100644\n--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -277,6 +277,7 @@ class Collector:\n             if self.can_fast_delete(instance):\n                 with transaction.mark_for_rollback_on_error():\n                     count = sql.DeleteQuery(model).delete_batch([instance.pk], self.using)\n+                setattr(instance, model._meta.pk.attname, None)\n                 return count, {model._meta.label: count}\n \n         with transaction.atomic(using=self.using, savepoint=False):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11283",
    "model_patch": "diff --git a/django/contrib/auth/migrations/0011_update_proxy_permissions.py b/django/contrib/auth/migrations/0011_update_proxy_permissions.py\nindex 0e66649695..6dcb10039e 100644\n--- a/django/contrib/auth/migrations/0011_update_proxy_permissions.py\n+++ b/django/contrib/auth/migrations/0011_update_proxy_permissions.py\n@@ -24,6 +24,11 @@ def update_proxy_model_permissions(apps, schema_editor, reverse=False):\n         proxy_content_type = ContentType.objects.get_for_model(Model, for_concrete_model=False)\n         old_content_type = proxy_content_type if reverse else concrete_content_type\n         new_content_type = concrete_content_type if reverse else proxy_content_type\n+        # Avoid duplicate permissions if the model was previously a proxy model.\n+        if not reverse:\n+            permissions_query = permissions_query & ~Q(content_type=proxy_content_type)\n+        else:\n+            permissions_query = permissions_query & ~Q(content_type=concrete_content_type)\n         Permission.objects.filter(\n             permissions_query,\n             content_type=old_content_type,",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11422",
    "model_patch": "diff --git a/django/utils/autoreload.py b/django/utils/autoreload.py\nindex 7ca0d68fae..5fb8a07cc0 100644\n--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -123,6 +123,13 @@ def iter_modules_and_files(modules, extra_files):\n             origin = spec.loader.archive if isinstance(spec.loader, zipimporter) else spec.origin\n             sys_file_paths.append(origin)\n \n+    # Add the main script if it's not already in sys.modules (e.g., manage.py)\n+    main_module = sys.modules.get('__main__')\n+    if main_module and hasattr(main_module, '__file__') and main_module.__file__:\n+        main_file = main_module.__file__\n+        if main_file not in sys_file_paths:\n+            sys_file_paths.append(main_file)\n+\n     results = set()\n     for filename in itertools.chain(sys_file_paths, extra_files):\n         if not filename:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11564",
    "model_patch": "diff --git a/django/core/files/storage.py b/django/core/files/storage.py\nindex 4c27fce605..2aca8a63ab 100644\n--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -7,6 +7,7 @@ from django.core.exceptions import SuspiciousFileOperation\n from django.core.files import File, locks\n from django.core.files.move import file_move_safe\n from django.core.signals import setting_changed\n+from django.urls import get_script_prefix\n from django.utils import timezone\n from django.utils._os import safe_join\n from django.utils.crypto import get_random_string\n@@ -332,7 +333,11 @@ class FileSystemStorage(Storage):\n         url = filepath_to_uri(name)\n         if url is not None:\n             url = url.lstrip('/')\n-        return urljoin(self.base_url, url)\n+        url = urljoin(self.base_url, url)\n+        script_name = get_script_prefix()\n+        if script_name != '/':\n+            url = urljoin(script_name, url)\n+        return url\n \n     def _datetime_from_timestamp(self, ts):\n         \"\"\"\ndiff --git a/django/templatetags/static.py b/django/templatetags/static.py\nindex 39712aaba0..5c79e68637 100644\n--- a/django/templatetags/static.py\n+++ b/django/templatetags/static.py\n@@ -2,6 +2,7 @@ from urllib.parse import quote, urljoin\n \n from django import template\n from django.apps import apps\n+from django.urls import get_script_prefix\n from django.utils.encoding import iri_to_uri\n from django.utils.html import conditional_escape\n \n@@ -48,6 +49,9 @@ class PrefixNode(template.Node):\n \n     def render(self, context):\n         prefix = self.handle_simple(self.name)\n+        script_name = get_script_prefix()\n+        if script_name != '/':\n+            prefix = urljoin(script_name, prefix)\n         if self.varname is None:\n             return prefix\n         context[self.varname] = prefix\n@@ -117,7 +121,11 @@ class StaticNode(template.Node):\n             from django.contrib.staticfiles.storage import staticfiles_storage\n             return staticfiles_storage.url(path)\n         else:\n-            return urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), quote(path))\n+            url = urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), quote(path))\n+            script_name = get_script_prefix()\n+            if script_name != '/':\n+                url = urljoin(script_name, url)\n+            return url\n \n     @classmethod\n     def handle_token(cls, parser, token):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11583",
    "model_patch": "diff --git a/django/utils/autoreload.py b/django/utils/autoreload.py\nindex 25c3b44250..3654675136 100644\n--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -139,9 +139,9 @@ def iter_modules_and_files(modules, extra_files):\n         path = Path(filename)\n         try:\n             resolved_path = path.resolve(strict=True).absolute()\n-        except FileNotFoundError:\n-            # The module could have been removed, don't fail loudly if this\n-            # is the case.\n+        except (FileNotFoundError, ValueError):\n+            # The module could have been removed, or the path could contain a null\n+            # byte. Don't fail loudly if this is the case.\n             continue\n         results.add(resolved_path)\n     return frozenset(results)\n@@ -187,7 +187,9 @@ def sys_path_directories():\n         path = Path(path)\n         try:\n             resolved_path = path.resolve(strict=True).absolute()\n-        except FileNotFoundError:\n+        except (FileNotFoundError, ValueError):\n+            # The path could have been removed, or the path could contain a null\n+            # byte. Skip it.\n             continue\n         # If the path is a file (like a zip file), watch the parent directory.\n         if resolved_path.is_file():",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11620",
    "model_patch": "diff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex 2154a46320..c719742c28 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -17,6 +17,7 @@ from django.conf import settings\n from django.core.checks import Error, Warning\n from django.core.checks.urls import check_resolver\n from django.core.exceptions import ImproperlyConfigured, ViewDoesNotExist\n+from django.http import Http404\n from django.utils.datastructures import MultiValueDict\n from django.utils.functional import cached_property\n from django.utils.http import RFC3986_SUBDELIMS, escape_leading_slashes\n@@ -260,6 +261,8 @@ class RoutePattern(CheckURLMixin):\n                     kwargs[key] = converter.to_python(value)\n                 except ValueError:\n                     return None\n+                except Http404:\n+                    raise\n             return path[match.end():], (), kwargs\n         return None",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11630",
    "model_patch": "diff --git a/django/core/checks/model_checks.py b/django/core/checks/model_checks.py\nindex 5c2266ca1d..1d92254976 100644\n--- a/django/core/checks/model_checks.py\n+++ b/django/core/checks/model_checks.py\n@@ -4,7 +4,9 @@ from collections import defaultdict\n from itertools import chain\n \n from django.apps import apps\n+from django.conf import settings\n from django.core.checks import Error, Tags, register\n+from django.db import router\n \n \n @register(Tags.models)\n@@ -37,14 +39,54 @@ def check_all_models(app_configs=None, **kwargs):\n             constraints[model_constraint.name].append(model._meta.label)\n     for db_table, model_labels in db_table_models.items():\n         if len(model_labels) != 1:\n-            errors.append(\n-                Error(\n-                    \"db_table '%s' is used by multiple models: %s.\"\n-                    % (db_table, ', '.join(db_table_models[db_table])),\n-                    obj=db_table,\n-                    id='models.E028',\n+            # Check if models with the same db_table would be in the same database.\n+            # Get the actual model classes from their labels.\n+            models_with_table = []\n+            for label in model_labels:\n+                app_label, model_name = label.split('.')\n+                try:\n+                    model = apps.get_model(app_label, model_name)\n+                    models_with_table.append(model)\n+                except LookupError:\n+                    # Model not found, treat it as a conflict\n+                    models_with_table.append(None)\n+\n+            # Check if there's any database where both models would be created\n+            has_conflict = False\n+            for i in range(len(models_with_table)):\n+                for j in range(i + 1, len(models_with_table)):\n+                    model1 = models_with_table[i]\n+                    model2 = models_with_table[j]\n+\n+                    if model1 is None or model2 is None:\n+                        # Couldn't get model info, assume conflict\n+                        has_conflict = True\n+                        break\n+\n+                    # Check if there's any database where both models would migrate\n+                    databases = settings.DATABASES\n+                    shared_databases = []\n+                    for db_alias in databases:\n+                        if (router.allow_migrate_model(db_alias, model1) and\n+                                router.allow_migrate_model(db_alias, model2)):\n+                            shared_databases.append(db_alias)\n+\n+                    if shared_databases:\n+                        has_conflict = True\n+                        break\n+\n+                if has_conflict:\n+                    break\n+\n+            if has_conflict:\n+                errors.append(\n+                    Error(\n+                        \"db_table '%s' is used by multiple models: %s.\"\n+                        % (db_table, ', '.join(db_table_models[db_table])),\n+                        obj=db_table,\n+                        id='models.E028',\n+                    )\n                 )\n-            )\n     for index_name, model_labels in indexes.items():\n         if len(model_labels) > 1:\n             model_labels = set(model_labels)",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11742",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex 9ce46e3f73..c6fd26e296 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -955,6 +955,7 @@ class CharField(Field):\n         return [\n             *super().check(**kwargs),\n             *self._check_max_length_attribute(**kwargs),\n+            *self._check_max_length_with_choices(),\n         ]\n \n     def _check_max_length_attribute(self, **kwargs):\n@@ -978,6 +979,39 @@ class CharField(Field):\n         else:\n             return []\n \n+    def _check_max_length_with_choices(self):\n+        if not self.choices or self.max_length is None:\n+            return []\n+\n+        # Find the longest choice value\n+        max_choice_length = 0\n+        for choice in self.choices:\n+            # Handle grouped choices: [group_name, [value, display]]\n+            if isinstance(choice, (list, tuple)) and len(choice) == 2:\n+                group_name, group_choices = choice\n+                if isinstance(group_choices, (list, tuple)):\n+                    # This is a grouped choice\n+                    for value, _ in group_choices:\n+                        if isinstance(value, str):\n+                            max_choice_length = max(max_choice_length, len(value))\n+                else:\n+                    # This is a regular choice: [value, display]\n+                    value, display = choice\n+                    if isinstance(value, str):\n+                        max_choice_length = max(max_choice_length, len(value))\n+\n+        if max_choice_length > self.max_length:\n+            return [\n+                checks.Error(\n+                    \"'max_length' is too small to fit the longest value in 'choices' \"\n+                    \"(%d characters).\" % max_choice_length,\n+                    hint=\"Increase 'max_length' to at least %d.\" % max_choice_length,\n+                    obj=self,\n+                    id='fields.E122',\n+                )\n+            ]\n+        return []\n+\n     def cast_db_type(self, connection):\n         if self.max_length is None:\n             return connection.ops.cast_char_field_without_max_length\ndiff --git a/tests/invalid_models_tests/test_ordinary_fields.py b/tests/invalid_models_tests/test_ordinary_fields.py\nindex 5bb1847a70..7182084970 100644\n--- a/tests/invalid_models_tests/test_ordinary_fields.py\n+++ b/tests/invalid_models_tests/test_ordinary_fields.py\n@@ -352,6 +352,47 @@ class CharFieldTests(SimpleTestCase):\n             )\n         ])\n \n+    def test_max_length_with_long_choice_value(self):\n+        class Model(models.Model):\n+            field = models.CharField(max_length=2, choices=[('aaa', 'AAA'), ('b', 'B')])\n+\n+        field = Model._meta.get_field('field')\n+        self.assertEqual(field.check(), [\n+            Error(\n+                \"'max_length' is too small to fit the longest value in 'choices' (3 characters).\",\n+                hint=\"Increase 'max_length' to at least 3.\",\n+                obj=field,\n+                id='fields.E122',\n+            ),\n+        ])\n+\n+    def test_max_length_with_long_choice_value_grouped(self):\n+        class Model(models.Model):\n+            field = models.CharField(\n+                max_length=2,\n+                choices=[\n+                    ['Group 1', [['aaa', 'AAA'], ['b', 'B']]],\n+                    ['Group 2', [['cc', 'CC']]],\n+                ]\n+            )\n+\n+        field = Model._meta.get_field('field')\n+        self.assertEqual(field.check(), [\n+            Error(\n+                \"'max_length' is too small to fit the longest value in 'choices' (3 characters).\",\n+                hint=\"Increase 'max_length' to at least 3.\",\n+                obj=field,\n+                id='fields.E122',\n+            ),\n+        ])\n+\n+    def test_max_length_with_fitting_choice_values(self):\n+        class Model(models.Model):\n+            field = models.CharField(max_length=5, choices=[('a', 'A'), ('bb', 'BB'), ('ccc', 'CCC')])\n+\n+        field = Model._meta.get_field('field')\n+        self.assertEqual(field.check(), [])\n+\n \n @isolate_apps('invalid_models_tests')\n class DateFieldTests(SimpleTestCase):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11797",
    "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex e287a6f55a..856223109f 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -107,10 +107,14 @@ class SQLCompiler:\n         # Note that even if the group_by is set, it is only the minimal\n         # set to group by. So, we need to add cols in select, order_by, and\n         # having into the select in any case.\n-        for expr, _, _ in select:\n-            cols = expr.get_group_by_cols()\n-            for col in cols:\n-                expressions.append(col)\n+        # However, if the group_by is explicitly set (a tuple), then don't\n+        # add columns from the select clause as this will override the\n+        # explicitly set GROUP BY.\n+        if self.query.group_by is True or self.query.group_by is None:\n+            for expr, _, _ in select:\n+                cols = expr.get_group_by_cols()\n+                for col in cols:\n+                    expressions.append(col)\n         for expr, (sql, params, is_ref) in order_by:\n             # Skip References to the select clause, as all expressions in the\n             # select clause are already part of the group by.",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11815",
    "model_patch": "diff --git a/django/db/migrations/serializer.py b/django/db/migrations/serializer.py\nindex 27b5cbd379..23e70672ff 100644\n--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -120,9 +120,7 @@ class EnumSerializer(BaseSerializer):\n     def serialize(self):\n         enum_class = self.value.__class__\n         module = enum_class.__module__\n-        v_string, v_imports = serializer_factory(self.value.value).serialize()\n-        imports = {'import %s' % module, *v_imports}\n-        return \"%s.%s(%s)\" % (module, enum_class.__name__, v_string), imports\n+        return \"%s.%s[%r]\" % (module, enum_class.__name__, self.value.name), {'import %s' % module}\n \n \n class FloatSerializer(BaseSimpleSerializer):\ndiff --git a/tests/migrations/test_writer.py b/tests/migrations/test_writer.py\nindex f97d76e9ad..39c9ab47b9 100644\n--- a/tests/migrations/test_writer.py\n+++ b/tests/migrations/test_writer.py\n@@ -267,15 +267,15 @@ class WriterTests(SimpleTestCase):\n \n         self.assertSerializedResultEqual(\n             TextEnum.A,\n-            (\"migrations.test_writer.TextEnum('a-value')\", {'import migrations.test_writer'})\n+            (\"migrations.test_writer.TextEnum['A']\", {'import migrations.test_writer'})\n         )\n         self.assertSerializedResultEqual(\n             BinaryEnum.A,\n-            (\"migrations.test_writer.BinaryEnum(b'a-value')\", {'import migrations.test_writer'})\n+            (\"migrations.test_writer.BinaryEnum['A']\", {'import migrations.test_writer'})\n         )\n         self.assertSerializedResultEqual(\n             IntEnum.B,\n-            (\"migrations.test_writer.IntEnum(2)\", {'import migrations.test_writer'})\n+            (\"migrations.test_writer.IntEnum['B']\", {'import migrations.test_writer'})\n         )\n \n         field = models.CharField(default=TextEnum.B, choices=[(m.value, m) for m in TextEnum])\n@@ -283,27 +283,27 @@ class WriterTests(SimpleTestCase):\n         self.assertEqual(\n             string,\n             \"models.CharField(choices=[\"\n-            \"('a-value', migrations.test_writer.TextEnum('a-value')), \"\n-            \"('value-b', migrations.test_writer.TextEnum('value-b'))], \"\n-            \"default=migrations.test_writer.TextEnum('value-b'))\"\n+            \"('a-value', migrations.test_writer.TextEnum['A']), \"\n+            \"('value-b', migrations.test_writer.TextEnum['B'])], \"\n+            \"default=migrations.test_writer.TextEnum['B'])\"\n         )\n         field = models.CharField(default=BinaryEnum.B, choices=[(m.value, m) for m in BinaryEnum])\n         string = MigrationWriter.serialize(field)[0]\n         self.assertEqual(\n             string,\n             \"models.CharField(choices=[\"\n-            \"(b'a-value', migrations.test_writer.BinaryEnum(b'a-value')), \"\n-            \"(b'value-b', migrations.test_writer.BinaryEnum(b'value-b'))], \"\n-            \"default=migrations.test_writer.BinaryEnum(b'value-b'))\"\n+            \"(b'a-value', migrations.test_writer.BinaryEnum['A']), \"\n+            \"(b'value-b', migrations.test_writer.BinaryEnum['B'])], \"\n+            \"default=migrations.test_writer.BinaryEnum['B'])\"\n         )\n         field = models.IntegerField(default=IntEnum.A, choices=[(m.value, m) for m in IntEnum])\n         string = MigrationWriter.serialize(field)[0]\n         self.assertEqual(\n             string,\n             \"models.IntegerField(choices=[\"\n-            \"(1, migrations.test_writer.IntEnum(1)), \"\n-            \"(2, migrations.test_writer.IntEnum(2))], \"\n-            \"default=migrations.test_writer.IntEnum(1))\"\n+            \"(1, migrations.test_writer.IntEnum['A']), \"\n+            \"(2, migrations.test_writer.IntEnum['B'])], \"\n+            \"default=migrations.test_writer.IntEnum['A'])\"\n         )\n \n     def test_serialize_choices(self):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11848",
    "model_patch": "diff --git a/django/utils/http.py b/django/utils/http.py\nindex 572cfb4347..d1cedb4349 100644\n--- a/django/utils/http.py\n+++ b/django/utils/http.py\n@@ -176,10 +176,16 @@ def parse_http_date(date):\n     try:\n         year = int(m.group('year'))\n         if year < 100:\n-            if year < 70:\n-                year += 2000\n-            else:\n-                year += 1900\n+            # RFC 7231: Recipients of timestamp in rfc850-date format (two-digit year)\n+            # MUST interpret a timestamp that appears to be more than 50 years in the\n+            # future as representing the most recent year in the past that had the\n+            # same last two digits.\n+            current_year = datetime.datetime.utcnow().year\n+            current_century = current_year // 100 * 100\n+            year += current_century\n+            # \"more than 50 years\" means > 50, not >= 50\n+            if year - current_year > 50:\n+                year -= 100\n         month = MONTHS.index(m.group('mon').lower()) + 1\n         day = int(m.group('day'))\n         hour = int(m.group('hour'))",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11905",
    "model_patch": "diff --git a/django/db/models/lookups.py b/django/db/models/lookups.py\nindex 9344979c56..bff6bbe089 100644\n--- a/django/db/models/lookups.py\n+++ b/django/db/models/lookups.py\n@@ -462,6 +462,13 @@ class IsNull(BuiltinLookup):\n     lookup_name = 'isnull'\n     prepare_rhs = False\n \n+    def __init__(self, lhs, rhs):\n+        if not hasattr(rhs, 'resolve_expression') and not isinstance(rhs, bool):\n+            raise ValueError(\n+                'The QuerySet value for an isnull lookup must be True or False.'\n+            )\n+        super().__init__(lhs, rhs)\n+\n     def as_sql(self, compiler, connection):\n         sql, params = compiler.compile(self.lhs)\n         if self.rhs:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11910",
    "model_patch": "diff --git a/django/db/migrations/autodetector.py b/django/db/migrations/autodetector.py\nindex 1c40161c7f..d9ced5315e 100644\n--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -915,41 +915,43 @@ class MigrationAutodetector:\n             dependencies = []\n             # Implement any model renames on relations; these are handled by RenameModel\n             # so we need to exclude them from the comparison\n-            if hasattr(new_field, \"remote_field\") and getattr(new_field.remote_field, \"model\", None):\n+            # Clone the field to avoid mutating the original which is needed for the AlterField operation\n+            new_field_clone = new_field.clone() if hasattr(new_field, \"remote_field\") else new_field\n+            if hasattr(new_field_clone, \"remote_field\") and getattr(new_field_clone.remote_field, \"model\", None):\n                 rename_key = (\n-                    new_field.remote_field.model._meta.app_label,\n-                    new_field.remote_field.model._meta.model_name,\n+                    new_field_clone.remote_field.model._meta.app_label,\n+                    new_field_clone.remote_field.model._meta.model_name,\n                 )\n                 if rename_key in self.renamed_models:\n-                    new_field.remote_field.model = old_field.remote_field.model\n+                    new_field_clone.remote_field.model = old_field.remote_field.model\n                 # Handle ForeignKey which can only have a single to_field.\n-                remote_field_name = getattr(new_field.remote_field, 'field_name', None)\n+                remote_field_name = getattr(new_field_clone.remote_field, 'field_name', None)\n                 if remote_field_name:\n                     to_field_rename_key = rename_key + (remote_field_name,)\n                     if to_field_rename_key in self.renamed_fields:\n-                        new_field.remote_field.field_name = old_field.remote_field.field_name\n+                        new_field_clone.remote_field.field_name = old_field.remote_field.field_name\n                 # Handle ForeignObjects which can have multiple from_fields/to_fields.\n-                from_fields = getattr(new_field, 'from_fields', None)\n+                from_fields = getattr(new_field_clone, 'from_fields', None)\n                 if from_fields:\n                     from_rename_key = (app_label, model_name)\n-                    new_field.from_fields = tuple([\n+                    new_field_clone.from_fields = tuple([\n                         self.renamed_fields.get(from_rename_key + (from_field,), from_field)\n                         for from_field in from_fields\n                     ])\n-                    new_field.to_fields = tuple([\n+                    new_field_clone.to_fields = tuple([\n                         self.renamed_fields.get(rename_key + (to_field,), to_field)\n-                        for to_field in new_field.to_fields\n+                        for to_field in new_field_clone.to_fields\n                     ])\n                 dependencies.extend(self._get_dependencies_for_foreign_key(new_field))\n-            if hasattr(new_field, \"remote_field\") and getattr(new_field.remote_field, \"through\", None):\n+            if hasattr(new_field_clone, \"remote_field\") and getattr(new_field_clone.remote_field, \"through\", None):\n                 rename_key = (\n-                    new_field.remote_field.through._meta.app_label,\n-                    new_field.remote_field.through._meta.model_name,\n+                    new_field_clone.remote_field.through._meta.app_label,\n+                    new_field_clone.remote_field.through._meta.model_name,\n                 )\n                 if rename_key in self.renamed_models:\n-                    new_field.remote_field.through = old_field.remote_field.through\n+                    new_field_clone.remote_field.through = old_field.remote_field.through\n             old_field_dec = self.deep_deconstruct(old_field)\n-            new_field_dec = self.deep_deconstruct(new_field)\n+            new_field_dec = self.deep_deconstruct(new_field_clone)\n             if old_field_dec != new_field_dec:\n                 both_m2m = old_field.many_to_many and new_field.many_to_many\n                 neither_m2m = not old_field.many_to_many and not new_field.many_to_many\ndiff --git a/tests/migrations/test_autodetector.py b/tests/migrations/test_autodetector.py\nindex 1d5b8ef463..f642923570 100644\n--- a/tests/migrations/test_autodetector.py\n+++ b/tests/migrations/test_autodetector.py\n@@ -863,6 +863,38 @@ class AutodetectorTests(TestCase):\n         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])\n         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='field', new_name='renamed_field')\n \n+    def test_rename_primary_key_with_foreign_key(self):\n+        \"\"\"\n+        Test that when a primary key field is renamed, ForeignKeys that\n+        reference it (without explicit to_field) have their to_field updated.\n+        \"\"\"\n+        before = [\n+            ModelState('app', 'ModelA', [\n+                ('field_wrong', models.CharField(max_length=50, primary_key=True)),\n+            ]),\n+            ModelState('app', 'ModelB', [\n+                ('id', models.AutoField(primary_key=True)),\n+                ('field_fk', models.ForeignKey('app.ModelA', models.CASCADE)),\n+            ]),\n+        ]\n+        after = [\n+            ModelState('app', 'ModelA', [\n+                ('field_fixed', models.CharField(max_length=50, primary_key=True)),\n+            ]),\n+            ModelState('app', 'ModelB', [\n+                ('id', models.AutoField(primary_key=True)),\n+                ('field_fk', models.ForeignKey('app.ModelA', models.CASCADE)),\n+            ]),\n+        ]\n+        changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))\n+        # Right number/type of migrations?\n+        self.assertNumberMigrations(changes, 'app', 1)\n+        self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'AlterField'])\n+        self.assertOperationAttributes(changes, 'app', 0, 0, old_name='field_wrong', new_name='field_fixed')\n+        # Verify the AlterField operation has the correct to_field\n+        alter_field_op = changes['app'][0].operations[1]\n+        self.assertEqual(alter_field_op.field.remote_field.field_name, 'field_fixed')\n+\n     def test_rename_foreign_object_fields(self):\n         fields = ('first', 'second')\n         renamed_fields = ('first_renamed', 'second_renamed')",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11964",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex d610dc86f0..ac8f308f76 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -2,6 +2,7 @@ import collections.abc\n import copy\n import datetime\n import decimal\n+import enum\n import operator\n import uuid\n import warnings\n@@ -1009,6 +1010,8 @@ class CharField(Field):\n \n     def to_python(self, value):\n         if isinstance(value, str) or value is None:\n+            if isinstance(value, enum.Enum):\n+                value = value.value\n             return value\n         return str(value)\n \n@@ -1769,6 +1772,8 @@ class IntegerField(Field):\n     def to_python(self, value):\n         if value is None:\n             return value\n+        if isinstance(value, enum.Enum):\n+            value = value.value\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n@@ -2024,6 +2029,8 @@ class TextField(Field):\n \n     def to_python(self, value):\n         if isinstance(value, str) or value is None:\n+            if isinstance(value, enum.Enum):\n+                value = value.value\n             return value\n         return str(value)",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-11999",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex ee45bb941e..7754ffc646 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -763,8 +763,9 @@ class Field(RegisterLookupMixin):\n             if not getattr(cls, self.attname, None):\n                 setattr(cls, self.attname, self.descriptor_class(self))\n         if self.choices is not None:\n-            setattr(cls, 'get_%s_display' % self.name,\n-                    partialmethod(cls._get_FIELD_display, field=self))\n+            if not hasattr(cls, 'get_%s_display' % self.name):\n+                setattr(cls, 'get_%s_display' % self.name,\n+                        partialmethod(cls._get_FIELD_display, field=self))\n \n     def get_filter_kwargs_for_object(self, obj):\n         \"\"\"",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12113",
    "model_patch": "diff --git a/django/db/backends/sqlite3/creation.py b/django/db/backends/sqlite3/creation.py\nindex d97052f52d..f259e2110f 100644\n--- a/django/db/backends/sqlite3/creation.py\n+++ b/django/db/backends/sqlite3/creation.py\n@@ -24,6 +24,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n         test_database_name = self._get_test_db_name()\n \n         if keepdb:\n+            self.connection.close()\n             return test_database_name\n         if not self.is_in_memory_db(test_database_name):\n             # Erase the old test database",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12125",
    "model_patch": "diff --git a/django/db/migrations/serializer.py b/django/db/migrations/serializer.py\nindex 7d226955d5..00e7bea1b7 100644\n--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -267,9 +267,9 @@ class TypeSerializer(BaseSerializer):\n         if hasattr(self.value, \"__module__\"):\n             module = self.value.__module__\n             if module == builtins.__name__:\n-                return self.value.__name__, set()\n+                return self.value.__qualname__, set()\n             else:\n-                return \"%s.%s\" % (module, self.value.__name__), {\"import %s\" % module}\n+                return \"%s.%s\" % (module, self.value.__qualname__), {\"import %s\" % module}\n \n \n class UUIDSerializer(BaseSerializer):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12184",
    "model_patch": "diff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex 2d4610aac4..7a67661ce4 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -159,7 +159,7 @@ class RegexPattern(CheckURLMixin):\n             # non-named groups. Otherwise, pass all non-named arguments as\n             # positional arguments.\n             kwargs = {k: v for k, v in match.groupdict().items() if v is not None}\n-            args = () if kwargs else match.groups()\n+            args = () if kwargs else tuple(g for g in match.groups() if g is not None)\n             return path[match.end():], args, kwargs\n         return None",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12284",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex 1a55d3d417..cccb56d08c 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -764,12 +764,11 @@ class Field(RegisterLookupMixin):\n             if not getattr(cls, self.attname, None):\n                 setattr(cls, self.attname, self.descriptor_class(self))\n         if self.choices is not None:\n-            if not hasattr(cls, 'get_%s_display' % self.name):\n-                setattr(\n-                    cls,\n-                    'get_%s_display' % self.name,\n-                    partialmethod(cls._get_FIELD_display, field=self),\n-                )\n+            setattr(\n+                cls,\n+                'get_%s_display' % self.name,\n+                partialmethod(cls._get_FIELD_display, field=self),\n+            )\n \n     def get_filter_kwargs_for_object(self, obj):\n         \"\"\"",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12286",
    "model_patch": "diff --git a/django/core/checks/translation.py b/django/core/checks/translation.py\nindex 138ed07ff8..a2743fc49b 100644\n--- a/django/core/checks/translation.py\n+++ b/django/core/checks/translation.py\n@@ -56,6 +56,11 @@ def check_setting_languages_bidi(app_configs, **kwargs):\n def check_language_settings_consistent(app_configs, **kwargs):\n     \"\"\"Error if language settings are not consistent with each other.\"\"\"\n     available_tags = {i for i, _ in settings.LANGUAGES} | {'en-us'}\n-    if settings.LANGUAGE_CODE not in available_tags:\n-        return [E004]\n-    return []\n+    # Check if LANGUAGE_CODE is directly available\n+    if settings.LANGUAGE_CODE in available_tags:\n+        return []\n+    # Check if the base language is available for sublanguages\n+    base_language = settings.LANGUAGE_CODE.split('-')[0].lower()\n+    if base_language in available_tags:\n+        return []\n+    return [E004]\ndiff --git a/tests/check_framework/test_translation.py b/tests/check_framework/test_translation.py\nindex 4cd79d803f..33cf8f85c7 100644\n--- a/tests/check_framework/test_translation.py\n+++ b/tests/check_framework/test_translation.py\n@@ -84,3 +84,21 @@ class TranslationCheckTests(SimpleTestCase):\n             self.assertEqual(check_language_settings_consistent(None), [\n                 Error(msg, id='translation.E004'),\n             ])\n+\n+    def test_sublanguage_with_base_language_available(self):\n+        \"\"\"Sublanguage should be accepted when base language is available.\"\"\"\n+        # Test de-at with base language de available\n+        with self.settings(LANGUAGE_CODE='de-at', LANGUAGES=[('de', 'German')]):\n+            self.assertEqual(check_language_settings_consistent(None), [])\n+\n+    def test_sublanguage_without_base_language_available(self):\n+        \"\"\"Sublanguage should raise error when base language is not available.\"\"\"\n+        msg = (\n+            'You have provided a value for the LANGUAGE_CODE setting that is '\n+            'not in the LANGUAGES setting.'\n+        )\n+        # Test de-at without base language de available\n+        with self.settings(LANGUAGE_CODE='de-at', LANGUAGES=[('en', 'English')]):\n+            self.assertEqual(check_language_settings_consistent(None), [\n+                Error(msg, id='translation.E004'),\n+            ])",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12308",
    "model_patch": "diff --git a/django/contrib/admin/utils.py b/django/contrib/admin/utils.py\nindex e4ddc8f017..7a85b11bba 100644\n--- a/django/contrib/admin/utils.py\n+++ b/django/contrib/admin/utils.py\n@@ -1,5 +1,6 @@\n import datetime\n import decimal\n+import json\n from collections import defaultdict\n \n from django.core.exceptions import FieldDoesNotExist\n@@ -390,7 +391,9 @@ def display_for_field(value, field, empty_value_display):\n         return empty_value_display\n     elif isinstance(field, models.DateTimeField):\n         return formats.localize(timezone.template_localtime(value))\n-    elif isinstance(field, (models.DateField, models.TimeField)):\n+    elif isinstance(field, models.DateField):\n+        return formats.localize(value)\n+    elif isinstance(field, models.TimeField):\n         return formats.localize(value)\n     elif isinstance(field, models.DecimalField):\n         return formats.number_format(value, field.decimal_places)\n@@ -398,6 +401,11 @@ def display_for_field(value, field, empty_value_display):\n         return formats.number_format(value)\n     elif isinstance(field, models.FileField) and value:\n         return format_html('<a href=\"{}\">{}</a>', value.url, value)\n+    elif isinstance(field, models.JSONField):\n+        try:\n+            return json.dumps(value, cls=field.encoder)\n+        except TypeError:\n+            return str(value)\n     else:\n         return display_for_value(value, empty_value_display)",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12453",
    "model_patch": "diff --git a/django/db/backends/base/creation.py b/django/db/backends/base/creation.py\nindex c50fc90171..5cf1f5b3c2 100644\n--- a/django/db/backends/base/creation.py\n+++ b/django/db/backends/base/creation.py\n@@ -5,7 +5,7 @@ from io import StringIO\n from django.apps import apps\n from django.conf import settings\n from django.core import serializers\n-from django.db import router\n+from django.db import router, transaction\n \n # The prefix to put on the default database name when creating\n # the test database.\n@@ -126,8 +126,9 @@ class BaseDatabaseCreation:\n         the serialize_db_to_string() method.\n         \"\"\"\n         data = StringIO(data)\n-        for obj in serializers.deserialize(\"json\", data, using=self.connection.alias):\n-            obj.save()\n+        with transaction.atomic(using=self.connection.alias):\n+            for obj in serializers.deserialize(\"json\", data, using=self.connection.alias):\n+                obj.save()\n \n     def _get_database_display_str(self, verbosity, database_name):\n         \"\"\"",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12470",
    "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 92213a4e67..8c941f8f18 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -727,7 +727,7 @@ class SQLCompiler:\n                     results.append((item, False))\n                     continue\n                 results.extend(self.find_ordering_name(item, opts, alias,\n-                                                       order, already_seen))\n+                                                       default_order, already_seen))\n             return results\n         targets, alias, _ = self.query.trim_joins(targets, joins, path)\n         return [(OrderBy(transform_function(t, alias), descending=descending), False) for t in targets]",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12497",
    "model_patch": "diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py\nindex 8ddbb5ba68..536b3dd601 100644\n--- a/django/db/models/fields/related.py\n+++ b/django/db/models/fields/related.py\n@@ -1309,7 +1309,7 @@ class ManyToManyField(RelatedField):\n                              \"through_fields keyword argument.\") % (self, from_model_name),\n                             hint=(\n                                 'If you want to create a recursive relationship, '\n-                                'use ForeignKey(\"%s\", symmetrical=False, through=\"%s\").'\n+                                'use ManyToManyField(\"%s\", through=\"%s\").'\n                             ) % (\n                                 RECURSIVE_RELATIONSHIP_CONSTANT,\n                                 relationship_model_name,\n@@ -1329,7 +1329,7 @@ class ManyToManyField(RelatedField):\n                             \"through_fields keyword argument.\" % (self, to_model_name),\n                             hint=(\n                                 'If you want to create a recursive relationship, '\n-                                'use ForeignKey(\"%s\", symmetrical=False, through=\"%s\").'\n+                                'use ManyToManyField(\"%s\", through=\"%s\").'\n                             ) % (\n                                 RECURSIVE_RELATIONSHIP_CONSTANT,\n                                 relationship_model_name,\ndiff --git a/tests/invalid_models_tests/test_relative_fields.py b/tests/invalid_models_tests/test_relative_fields.py\nindex 24f27168c2..6ff5a2fa41 100644\n--- a/tests/invalid_models_tests/test_relative_fields.py\n+++ b/tests/invalid_models_tests/test_relative_fields.py\n@@ -152,7 +152,7 @@ class RelativeFieldTests(SimpleTestCase):\n                 \"keyword argument.\",\n                 hint=(\n                     'If you want to create a recursive relationship, use '\n-                    'ForeignKey(\"self\", symmetrical=False, through=\"AmbiguousRelationship\").'\n+                    'ManyToManyField(\"self\", through=\"AmbiguousRelationship\").'\n                 ),\n                 obj=field,\n                 id='fields.E335',",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12589",
    "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 63ca817355..312a8c4542 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -103,7 +103,12 @@ class SQLCompiler:\n             # Converts string references to expressions.\n             for expr in self.query.group_by:\n                 if not hasattr(expr, 'as_sql'):\n-                    expressions.append(self.query.resolve_ref(expr))\n+                    resolved_expr = self.query.resolve_ref(expr)\n+                    # If the resolved expression is an annotation, wrap it in a\n+                    # Ref to ensure it's properly referenced in the GROUP BY clause.\n+                    if expr in self.query.annotation_select:\n+                        resolved_expr = Ref(expr, resolved_expr)\n+                    expressions.append(resolved_expr)\n                 else:\n                     expressions.append(expr)\n         # Note that even if the group_by is set, it is only the minimal\ndiff --git a/tests/aggregation/tests.py b/tests/aggregation/tests.py\nindex 95b77ef87b..1f6449c12f 100644\n--- a/tests/aggregation/tests.py\n+++ b/tests/aggregation/tests.py\n@@ -1294,3 +1294,18 @@ class AggregateTestCase(TestCase):\n         # with self.assertNumQueries(1) as ctx:\n         #     self.assertSequenceEqual(books_qs, [book])\n         # self.assertEqual(ctx[0]['sql'].count('SELECT'), 2)\n+\n+    @skipUnlessDBFeature('supports_subqueries_in_group_by')\n+    def test_aggregation_subquery_annotation_in_values_group_by(self):\n+        \"\"\"\n+        Subquery annotations can be grouped against when selected through\n+        values() (#12589).\n+        \"\"\"\n+        latest_book_pubdate_qs = Book.objects.filter(\n+            publisher=OuterRef('pk'),\n+        ).order_by('-pubdate').values('pubdate')[:1]\n+        publishers = Publisher.objects.annotate(\n+            latest_pubdate=Subquery(latest_book_pubdate_qs),\n+        ).values('latest_pubdate').annotate(total=Count('pk'))\n+        # Should not raise \"column reference latest_pubdate is ambiguous\"\n+        self.assertGreater(len(list(publishers)), 0)",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-12700",
    "model_patch": "diff --git a/django/views/debug.py b/django/views/debug.py\nindex e6b7d4d821..8ccfb984ee 100644\n--- a/django/views/debug.py\n+++ b/django/views/debug.py\n@@ -84,12 +84,16 @@ class SafeExceptionReporterFilter:\n         \"\"\"\n         Cleanse an individual setting key/value of sensitive content. If the\n         value is a dictionary, recursively cleanse the keys in that dictionary.\n+        If the value is a list or tuple, recursively cleanse each element.\n         \"\"\"\n         try:\n             if self.hidden_settings.search(key):\n                 cleansed = self.cleansed_substitute\n             elif isinstance(value, dict):\n                 cleansed = {k: self.cleanse_setting(k, v) for k, v in value.items()}\n+            elif isinstance(value, (list, tuple)):\n+                # For lists and tuples, cleanse each element without a key context\n+                cleansed = type(value)(self.cleanse_setting('', v) for v in value)\n             else:\n                 cleansed = value\n         except TypeError:",
    "model_name_or_path": "sage-agent"
  }
]