[
  {
    "instance_id": "django__django-15819",
    "model_patch": "diff --git a/django/core/management/commands/inspectdb.py b/django/core/management/commands/inspectdb.py\nindex f33bcbdccf..98b1a354b8 100644\n--- a/django/core/management/commands/inspectdb.py\n+++ b/django/core/management/commands/inspectdb.py\n@@ -133,6 +133,7 @@ class Command(BaseCommand):\n                 known_models.append(table2model(table_name))\n                 used_column_names = []  # Holds column names used in the table so far\n                 column_to_field_name = {}  # Maps column names to names of model fields\n+                used_relations = {}  # Track relations to avoid reverse accessor clashes\n                 for row in table_description:\n                     comment_notes = (\n                         []\n@@ -182,6 +183,10 @@ class Command(BaseCommand):\n                             if ref_db_table == table_name\n                             else table2model(ref_db_table)\n                         )\n+                        # Add related_name if this model has multiple relations to the same table\n+                        if rel_to in used_relations:\n+                            extra_params[\"related_name\"] = att_name\n+                        used_relations[rel_to] = used_relations.get(rel_to, 0) + 1\n                         if rel_to in known_models:\n                             field_type = \"%s(%s\" % (rel_type, rel_to)\n                         else:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-15851",
    "model_patch": "diff --git a/django/db/backends/postgresql/client.py b/django/db/backends/postgresql/client.py\nindex 4c9bd63546..3b5ddafaca 100644\n--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -32,9 +32,9 @@ class DatabaseClient(BaseDatabaseClient):\n             args += [\"-h\", host]\n         if port:\n             args += [\"-p\", str(port)]\n+        args.extend(parameters)\n         if dbname:\n             args += [dbname]\n-        args.extend(parameters)\n \n         env = {}\n         if passwd:\ndiff --git a/tests/dbshell/test_postgresql.py b/tests/dbshell/test_postgresql.py\nindex 02924d0bcc..53dedaca01 100644\n--- a/tests/dbshell/test_postgresql.py\n+++ b/tests/dbshell/test_postgresql.py\n@@ -154,7 +154,7 @@ class PostgreSqlDbshellCommandTestCase(SimpleTestCase):\n     def test_parameters(self):\n         self.assertEqual(\n             self.settings_to_cmd_args_env({\"NAME\": \"dbname\"}, [\"--help\"]),\n-            ([\"psql\", \"dbname\", \"--help\"], None),\n+            ([\"psql\", \"--help\", \"dbname\"], None),\n         )\n \n     @skipUnless(connection.vendor == \"postgresql\", \"Requires a PostgreSQL connection\")",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-15902",
    "model_patch": "diff --git a/django/forms/utils.py b/django/forms/utils.py\nindex 905babce4d..8252a35fac 100644\n--- a/django/forms/utils.py\n+++ b/django/forms/utils.py\n@@ -65,9 +65,15 @@ class RenderableMixin:\n         renderer = renderer or self.renderer\n         template = template_name or self.template_name\n         context = context or self.get_context()\n+        # Avoid the deprecation warning for ManagementForm as it only renders\n+        # hidden inputs and the template used is insignificant.\n+        from django.forms.formsets import ManagementForm\n         if (\n-            template == \"django/forms/default.html\"\n-            or template == \"django/forms/formsets/default.html\"\n+            not isinstance(self, ManagementForm)\n+            and (\n+                template == \"django/forms/default.html\"\n+                or template == \"django/forms/formsets/default.html\"\n+            )\n         ):\n             warnings.warn(\n                 DEFAULT_TEMPLATE_DEPRECATION_MSG, RemovedInDjango50Warning, stacklevel=2",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16041",
    "model_patch": "diff --git a/django/forms/formsets.py b/django/forms/formsets.py\nindex 57676428ff..e1a0c830d1 100644\n--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -257,14 +257,12 @@ class BaseFormSet(RenderableFormMixin):\n \n     @property\n     def empty_form(self):\n-        form = self.form(\n-            auto_id=self.auto_id,\n-            prefix=self.add_prefix(\"__prefix__\"),\n-            empty_permitted=True,\n-            use_required_attribute=False,\n-            **self.get_form_kwargs(None),\n-            renderer=self.renderer,\n-        )\n+        defaults = {\"auto_id\": self.auto_id, \"prefix\": self.add_prefix(\"__prefix__\"), \"empty_permitted\": True, \"use_required_attribute\": False}\n+        defaults.update(self.get_form_kwargs(None))\n+        # Always use empty_permitted=True for empty_form.\n+        defaults[\"empty_permitted\"] = True\n+        defaults[\"renderer\"] = self.renderer\n+        form = self.form(**defaults)\n         self.add_fields(form, None)\n         return form",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16046",
    "model_patch": "diff --git a/django/utils/numberformat.py b/django/utils/numberformat.py\nindex 488d6a77cd..e952af3fdc 100644\n--- a/django/utils/numberformat.py\n+++ b/django/utils/numberformat.py\n@@ -68,7 +68,7 @@ def format(\n             str_number = \"{:f}\".format(number)\n     else:\n         str_number = str(number)\n-    if str_number[0] == \"-\":\n+    if str_number and str_number[0] == \"-\":\n         sign = \"-\"\n         str_number = str_number[1:]\n     # decimal part",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16139",
    "model_patch": "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex b3cfc6723c..f6c4b7fc2f 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -163,7 +163,7 @@ class UserChangeForm(forms.ModelForm):\n         super().__init__(*args, **kwargs)\n         password = self.fields.get(\"password\")\n         if password:\n-            password.help_text = password.help_text.format(\"../password/\")\n+            password.help_text = password.help_text.format(f\"../../{self.instance.pk}/password/\")\n         user_permissions = self.fields.get(\"user_permissions\")\n         if user_permissions:\n             user_permissions.queryset = user_permissions.queryset.select_related(",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16229",
    "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex 2a98396cad..7588be8d66 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -1014,7 +1014,6 @@ class Field(RegisterLookupMixin):\n         if self.has_default():\n             if callable(self.default):\n                 defaults[\"initial\"] = self.default\n-                defaults[\"show_hidden_initial\"] = True\n             else:\n                 defaults[\"initial\"] = self.get_default()\n         if self.choices is not None:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16255",
    "model_patch": "diff --git a/django/contrib/sitemaps/__init__.py b/django/contrib/sitemaps/__init__.py\nindex 27756d9d96..b40ad806ed 100644\n--- a/django/contrib/sitemaps/__init__.py\n+++ b/django/contrib/sitemaps/__init__.py\n@@ -168,7 +168,7 @@ class Sitemap:\n         if callable(self.lastmod):\n             try:\n                 return max([self.lastmod(item) for item in self.items()])\n-            except TypeError:\n+            except (TypeError, ValueError):\n                 return None\n         else:\n             return self.lastmod",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16379",
    "model_patch": "diff --git a/django/core/cache/backends/filebased.py b/django/core/cache/backends/filebased.py\nindex 631da49444..215fefbcc0 100644\n--- a/django/core/cache/backends/filebased.py\n+++ b/django/core/cache/backends/filebased.py\n@@ -90,10 +90,11 @@ class FileBasedCache(BaseCache):\n \n     def has_key(self, key, version=None):\n         fname = self._key_to_file(key, version)\n-        if os.path.exists(fname):\n+        try:\n             with open(fname, \"rb\") as f:\n                 return not self._is_expired(f)\n-        return False\n+        except FileNotFoundError:\n+            return False\n \n     def _cull(self):\n         \"\"\"",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16400",
    "model_patch": "diff --git a/django/contrib/contenttypes/models.py b/django/contrib/contenttypes/models.py\nindex 759a53ce67..f6a6975774 100644\n--- a/django/contrib/contenttypes/models.py\n+++ b/django/contrib/contenttypes/models.py\n@@ -46,14 +46,17 @@ class ContentTypeManager(models.Manager):\n \n         # The ContentType entry was not found in the cache, therefore we\n         # proceed to load or create it.\n+        # Use self.using(self._db) if self._db is set to bypass the router\n+        # and respect the explicit database parameter.\n+        manager = self.using(self._db) if self._db is not None else self\n         try:\n             # Start with get() and not get_or_create() in order to use\n             # the db_for_read (see #20401).\n-            ct = self.get(app_label=opts.app_label, model=opts.model_name)\n+            ct = manager.get(app_label=opts.app_label, model=opts.model_name)\n         except self.model.DoesNotExist:\n             # Not found in the database; we proceed to create it. This time\n             # use get_or_create to take care of any race conditions.\n-            ct, created = self.get_or_create(\n+            ct, created = manager.get_or_create(\n                 app_label=opts.app_label,\n                 model=opts.model_name,\n             )",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16408",
    "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 7c433b3f06..fdddde97c0 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1275,7 +1275,7 @@ class SQLCompiler:\n                     final_field.remote_field.set_cached_value(from_obj, obj)\n \n             def remote_setter(name, obj, from_obj):\n-                setattr(from_obj, name, obj)\n+                setattr(obj, name, from_obj)\n \n             for name in list(requested):\n                 # Filtered relations work only on the topmost level.",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16527",
    "model_patch": "diff --git a/django/contrib/admin/templatetags/admin_modify.py b/django/contrib/admin/templatetags/admin_modify.py\nindex 9df4b7aadb..5b742af46a 100644\n--- a/django/contrib/admin/templatetags/admin_modify.py\n+++ b/django/contrib/admin/templatetags/admin_modify.py\n@@ -100,6 +100,7 @@ def submit_row(context):\n                 and context.get(\"show_delete\", True)\n             ),\n             \"show_save_as_new\": not is_popup\n+            and has_add_permission\n             and has_change_permission\n             and change\n             and save_as,",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16595",
    "model_patch": "diff --git a/django/db/migrations/operations/fields.py b/django/db/migrations/operations/fields.py\nindex cd3aab43ad..12c988c441 100644\n--- a/django/db/migrations/operations/fields.py\n+++ b/django/db/migrations/operations/fields.py\n@@ -247,7 +247,11 @@ class AlterField(FieldOperation):\n         return \"alter_%s_%s\" % (self.model_name_lower, self.name_lower)\n \n     def reduce(self, operation, app_label):\n-        if isinstance(operation, RemoveField) and self.is_same_field_operation(\n+        if isinstance(operation, AlterField) and self.is_same_field_operation(\n+            operation\n+        ):\n+            return [operation]\n+        elif isinstance(operation, RemoveField) and self.is_same_field_operation(\n             operation\n         ):\n             return [operation]",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "django__django-16816",
    "model_patch": "diff --git a/django/contrib/admin/checks.py b/django/contrib/admin/checks.py\nindex 0fefe65e48..84ae0f9916 100644\n--- a/django/contrib/admin/checks.py\n+++ b/django/contrib/admin/checks.py\n@@ -927,6 +927,17 @@ class ModelAdminChecks(BaseModelAdminChecks):\n                     id=\"admin.E109\",\n                 )\n             ]\n+        # Check for reverse relations (e.g., when Choice has ForeignKey to Question,\n+        # Question has a reverse relation 'choice_set' or custom related_name).\n+        if getattr(field, \"is_relation\", False) and getattr(field, \"one_to_many\", False):\n+            return [\n+                checks.Error(\n+                    f\"The value of '{label}' must not be a many-to-many field or a \"\n+                    f\"reverse foreign key.\",\n+                    obj=obj.__class__,\n+                    id=\"admin.E109\",\n+                )\n+            ]\n         return []\n \n     def _check_list_display_links(self, obj):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "psf__requests-1963",
    "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex 425db22c..a4e4b850 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -88,7 +88,7 @@ class SessionRedirectMixin(object):\n         i = 0\n \n         while resp.is_redirect:\n-            prepared_request = req.copy()\n+            prepared_request = resp.request.copy()\n \n             resp.content  # Consume socket so it can be released\n \n@@ -99,7 +99,7 @@ class SessionRedirectMixin(object):\n             resp.close()\n \n             url = resp.headers['location']\n-            method = req.method\n+            method = resp.request.method\n \n             # Handle redirection without scheme (see: RFC 1808 Section 4)\n             if url.startswith('//'):",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "psf__requests-2148",
    "model_patch": "diff --git a/requests/models.py b/requests/models.py\nindex 0dc55568..f60ea75c 100644\n--- a/requests/models.py\n+++ b/requests/models.py\n@@ -9,6 +9,7 @@ This module contains the primary objects that power Requests.\n \n import collections\n import datetime\n+import socket\n \n from io import BytesIO, UnsupportedOperation\n from .hooks import default_hooks\n@@ -22,7 +23,7 @@ from .packages.urllib3.util import parse_url\n from .packages.urllib3.exceptions import DecodeError\n from .exceptions import (\n     HTTPError, RequestException, MissingSchema, InvalidURL,\n-    ChunkedEncodingError, ContentDecodingError)\n+    ChunkedEncodingError, ContentDecodingError, ConnectionError)\n from .utils import (\n     guess_filename, get_auth_from_url, requote_uri,\n     stream_decode_response_unicode, to_key_val_list, parse_header_links,\n@@ -636,6 +637,8 @@ class Response(object):\n                 try:\n                     for chunk in self.raw.stream(chunk_size, decode_content=True):\n                         yield chunk\n+                except socket.error as sockerr:\n+                    raise ConnectionError(sockerr)\n                 except IncompleteRead as e:\n                     raise ChunkedEncodingError(e)\n                 except DecodeError as e:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "psf__requests-2317",
    "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex d701ff2e..adcfbac7 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -425,7 +425,7 @@ class Session(SessionRedirectMixin):\n             If Tuple, ('cert', 'key') pair.\n         \"\"\"\n \n-        method = builtin_str(method)\n+        method = to_native_string(method)\n \n         # Create the Request.\n         req = Request(",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "psf__requests-2674",
    "model_patch": "diff --git a/requests/adapters.py b/requests/adapters.py\nindex 841cbbfe..dd68c68e 100644\n--- a/requests/adapters.py\n+++ b/requests/adapters.py\n@@ -20,6 +20,7 @@ from .utils import (DEFAULT_CA_BUNDLE_PATH, get_encoding_from_headers,\n                     prepend_scheme_if_needed, get_auth_from_url, urldefragauth)\n from .structures import CaseInsensitiveDict\n from .packages.urllib3.exceptions import ConnectTimeoutError\n+from .packages.urllib3.exceptions import DecodeError as _DecodeError\n from .packages.urllib3.exceptions import HTTPError as _HTTPError\n from .packages.urllib3.exceptions import MaxRetryError\n from .packages.urllib3.exceptions import ProxyError as _ProxyError\n@@ -27,9 +28,10 @@ from .packages.urllib3.exceptions import ProtocolError\n from .packages.urllib3.exceptions import ReadTimeoutError\n from .packages.urllib3.exceptions import SSLError as _SSLError\n from .packages.urllib3.exceptions import ResponseError\n+from .packages.urllib3.exceptions import TimeoutError as _TimeoutError\n from .cookies import extract_cookies_to_jar\n from .exceptions import (ConnectionError, ConnectTimeout, ReadTimeout, SSLError,\n-                         ProxyError, RetryError)\n+                         ProxyError, RetryError, ContentDecodingError)\n from .auth import _basic_auth_str\n \n DEFAULT_POOLBLOCK = False\n@@ -429,6 +431,10 @@ class HTTPAdapter(BaseAdapter):\n                 raise SSLError(e, request=request)\n             elif isinstance(e, ReadTimeoutError):\n                 raise ReadTimeout(e, request=request)\n+            elif isinstance(e, _DecodeError):\n+                raise ContentDecodingError(e, request=request)\n+            elif isinstance(e, _TimeoutError):\n+                raise ConnectTimeout(e, request=request)\n             else:\n                 raise",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "psf__requests-3362",
    "model_patch": "diff --git a/requests/utils.py b/requests/utils.py\nindex 8d17b6b2..330db97a 100644\n--- a/requests/utils.py\n+++ b/requests/utils.py\n@@ -360,9 +360,11 @@ def stream_decode_response_unicode(iterator, r):\n     \"\"\"Stream decodes a iterator.\"\"\"\n \n     if r.encoding is None:\n-        for item in iterator:\n-            yield item\n-        return\n+        r.encoding = r.apparent_encoding\n+        if r.encoding is None:\n+            for item in iterator:\n+                yield item\n+            return\n \n     decoder = codecs.getincrementaldecoder(r.encoding)(errors='replace')\n     for chunk in iterator:",
    "model_name_or_path": "sage-agent"
  },
  {
    "instance_id": "pydata__xarray-3364",
    "model_patch": "diff --git a/xarray/core/concat.py b/xarray/core/concat.py\nindex ecae2566..846ac532 100644\n--- a/xarray/core/concat.py\n+++ b/xarray/core/concat.py\n@@ -1,3 +1,4 @@\n+import numpy as np\n import pandas as pd\n \n from . import dtypes, utils\n@@ -312,15 +313,24 @@ def _dataset_concat(\n         to_merge = {var: [] for var in variables_to_merge}\n \n         for ds in datasets:\n-            absent_merge_vars = variables_to_merge - set(ds.variables)\n-            if absent_merge_vars:\n-                raise ValueError(\n-                    \"variables %r are present in some datasets but not others. \"\n-                    % absent_merge_vars\n-                )\n-\n             for var in variables_to_merge:\n-                to_merge[var].append(ds.variables[var])\n+                if var in ds.variables:\n+                    to_merge[var].append(ds.variables[var])\n+                else:\n+                    # Create a filled variable for missing data\n+                    if var in datasets[0].variables:\n+                        template_var = datasets[0].variables[var]\n+                        # Create a variable filled with fill_value\n+                        missing_var = template_var.copy()\n+                        missing_var.data = np.full(\n+                            template_var.shape, fill_value, dtype=template_var.dtype\n+                        )\n+                        to_merge[var].append(missing_var)\n+                    else:\n+                        raise ValueError(\n+                            \"variables %r are present in some datasets but not others. \"\n+                            % var\n+                        )\n \n         for var in variables_to_merge:\n             result_vars[var] = unique_variable(\n@@ -356,12 +366,36 @@ def _dataset_concat(\n \n     # stack up each variable to fill-out the dataset (in order)\n     # n.b. this loop preserves variable order, needed for groupby.\n-    for k in datasets[0].variables:\n+    # Get all variables that need to be concatenated\n+    all_vars = set()\n+    for ds in datasets:\n+        all_vars.update(ds.variables)\n+    \n+    for k in all_vars:\n         if k in concat_over:\n-            try:\n-                vars = ensure_common_dims([ds.variables[k] for ds in datasets])\n-            except KeyError:\n-                raise ValueError(\"%r is not present in all datasets.\" % k)\n+            vars_to_concat = []\n+            for ds in datasets:\n+                if k in ds.variables:\n+                    vars_to_concat.append(ds.variables[k])\n+                else:\n+                    # Create a filled variable for missing data\n+                    # Find a template from any dataset that has this variable\n+                    for template_ds in datasets:\n+                        if k in template_ds.variables:\n+                            template_var = template_ds.variables[k]\n+                            break\n+                    missing_var = template_var.copy()\n+                    # Get the shape for this dataset along the concat dimension\n+                    dim_len = ds.dims.get(dim, 1)\n+                    # Calculate the full shape for the missing variable\n+                    common_dims = tuple(pd.unique([d for v in [template_var] for d in v.dims]))\n+                    if dim not in common_dims:\n+                        common_dims = (dim,) + common_dims\n+                    common_shape = tuple(dims_sizes.get(d, dim_len) for d in common_dims)\n+                    missing_var.data = np.full(common_shape, fill_value, dtype=template_var.dtype)\n+                    vars_to_concat.append(missing_var)\n+\n+            vars = ensure_common_dims(vars_to_concat)\n             combined = concat_vars(vars, dim, positions)\n             assert isinstance(combined, Variable)\n             result_vars[k] = combined",
    "model_name_or_path": "sage-agent"
  }
]