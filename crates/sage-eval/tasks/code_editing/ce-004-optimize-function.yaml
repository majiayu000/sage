id: ce-004-optimize-function
name: Optimize Slow Function
description: |
  The `find_duplicates` function in `duplicates.py` is inefficient (O(n²)).
  Optimize it to run in O(n) time complexity using a set or dictionary.
  The function should still return the same results.
category: code_editing
difficulty: medium
timeout_secs: 180
expected_max_turns: 10
languages:
  - python
tags:
  - optimization
  - algorithm
  - performance
setup_files:
  duplicates.py: |
    def find_duplicates(items):
        """Find all duplicate items in a list."""
        duplicates = []
        for i in range(len(items)):
            for j in range(i + 1, len(items)):
                if items[i] == items[j] and items[i] not in duplicates:
                    duplicates.append(items[i])
        return duplicates
verifier:
  type: all
  verifiers:
    - type: test_command
      command: |
        python3 -c "
        from duplicates import find_duplicates

        # Test correctness
        result = find_duplicates([1, 2, 3, 2, 4, 3, 5])
        assert set(result) == {2, 3}

        result = find_duplicates([1, 2, 3])
        assert result == []

        result = find_duplicates(['a', 'b', 'a', 'c', 'b'])
        assert set(result) == {'a', 'b'}

        print('Function works correctly!')
        "
    - type: script
      script: |
        # Check that the nested loop is removed (no O(n²) pattern)
        content=$(cat duplicates.py)
        if echo "$content" | grep -q "for.*range.*len" && echo "$content" | grep -q "for.*range.*len.*+.*1"; then
          echo "Still has nested loops - not optimized"
          exit 1
        fi
        echo "Optimization check passed"
