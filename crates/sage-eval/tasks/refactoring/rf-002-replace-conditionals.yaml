id: rf-002-replace-conditionals
name: Replace Conditionals with Polymorphism
description: |
  The `calculate_shipping` function in `shipping.py` uses a long if-elif chain
  to handle different shipping methods. Refactor it to use a strategy pattern
  with separate classes for each shipping method.
category: refactoring
difficulty: medium
timeout_secs: 240
expected_max_turns: 15
languages:
  - python
tags:
  - strategy-pattern
  - polymorphism
  - design-patterns
setup_files:
  shipping.py: |
    def calculate_shipping(method, weight, distance):
        """Calculate shipping cost based on method, weight, and distance."""
        if method == "standard":
            base_cost = 5.0
            weight_cost = weight * 0.5
            distance_cost = distance * 0.1
            return base_cost + weight_cost + distance_cost
        elif method == "express":
            base_cost = 15.0
            weight_cost = weight * 1.0
            distance_cost = distance * 0.3
            return base_cost + weight_cost + distance_cost
        elif method == "overnight":
            base_cost = 25.0
            weight_cost = weight * 2.0
            distance_cost = distance * 0.5
            return base_cost + weight_cost + distance_cost
        elif method == "freight":
            base_cost = 50.0
            weight_cost = weight * 0.2
            distance_cost = distance * 0.05
            return base_cost + weight_cost + distance_cost
        else:
            raise ValueError(f"Unknown shipping method: {method}")
verifier:
  type: all
  verifiers:
    - type: file_contains
      path: shipping.py
      contains: "class"
    - type: test_command
      command: |
        python3 -c "
        from shipping import calculate_shipping

        # Test all methods still work
        assert calculate_shipping('standard', 10, 100) == 5.0 + 5.0 + 10.0
        assert calculate_shipping('express', 10, 100) == 15.0 + 10.0 + 30.0
        assert calculate_shipping('overnight', 10, 100) == 25.0 + 20.0 + 50.0
        assert calculate_shipping('freight', 10, 100) == 50.0 + 2.0 + 5.0

        try:
            calculate_shipping('invalid', 10, 100)
            assert False
        except ValueError:
            pass

        print('Refactoring successful!')
        "
